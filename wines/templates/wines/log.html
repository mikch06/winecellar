{% extends "./base.html" %}
{% block content %}
<div class="container">
    <div class="content">
    {% load static %}
<div class="container">
  <div class="row">
    <div class="col">
      MyBottles: <b>{{bottles_sum|default:"0"}}</b> Flaschen, {{wines_sum|default:"0"}} Positionen.
    </div>
    <div class="col">
    <p>
      <a class="btn btn-success btn-sm" href="/wines/export_xls"><i class="bi bi-filetype-xls" style="color: black;"></i></a> Excel Export
    </p>
    <p>
      <a class="btn btn-danger btn-sm" href="/wines/export"><i class="bi bi-filetype-csv" style="color: black;"></i></a> CSV Export
    </p>
    </div>
  </div>
  <div class="row">
    <div class="col">
        <b>Letzte 30 VerÃ¤nderungen im Keller:</b>
        <br><br>
        {% load static %}
        {% for wine in wines %}
        {% load static %}
        <div class="winelog">{{ wine.editdate|date:"d.m.Y"}}, 
          <a href="{% url 'wine_detail' wine.pk %}"
            up-layer="new modal"
            up-target="body">
            {{ wine.winename }}
          </a> -
          {{ wine.producer }}
          {{ wine.year }}
          ({{ wine.nmbrbottles }})
        </div>
        {% empty %}
        <li>Keine Weine gefunden.</li>  
        {% endfor %}


<a up-layer="new modal"
   up-size="large"
   up-href="{% url 'wine_stats' %}"
   class="btn btn-outline-primary">
   ðŸ“Š Statistik
</a>

<canvas id="countryChart" height="200" width="80"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  fetch("{% url 'wine_stats' %}", { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
    .then(response => response.json())
    .then(data => {
      const ctx = document.getElementById("countryChart");
      new Chart(ctx, {
        type: "pie",
        data: {
          labels: data.labels,
          datasets: [{
            label: "Anzahl Flaschen",
            data: data.bottles,
            borderWidth: 1,
            backgroundColor: [
              "#C0392B", "#8E44AD", "#3498DB", "#1ABC9C", "#F1C40F", "#E67E22", "#2ECC71"
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' },
            title: {
              display: true,
              text: 'Flaschen pro Land'
            }
          }
        }
      });
    });
});
</script>









        {% endblock %}
    </div>
    <div class="col">
    </div>
  </div>
</div>
















